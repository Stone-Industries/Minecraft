parameters:
  - name: MinecraftVersion
    default: ''
  - name: ModpackName
    default: ''
  - name: ModpackAuthor
    default: ''
  - name: ModpackVersion
    default: ''
  - name: ForgeVersion
    default: ''
  - name: GitHubOrg
    default: ''
  - name: GitHubRepo
    default: ''
  - name: PterodactylAddress
    default: ''
  - name: CreatePrerelease
    default: false
  - name: CreateRelease
    default: false
  - name: isProdDeployment
    default: false
  - name: SourcesDirectory
    default: ''
  - name: BinariesDirectory
    default: ''
  - name: ArtifactDirectory
    default: ''
  - name: PipelineWorkspace
    default: ''

stages:
  - template: ../stages/build-client-stage.yml
    parameters:
      MinecraftVersion: ${{ parameters.MinecraftVersion }}
      ModpackVersion: ${{ parameters.ModpackVersion }}
      ForgeVersion: ${{ parameters.ForgeVersion }}
      ModpackName: ${{ parameters.ModpackName }}
      ModpackAuthor: ${{ parameters.ModpackAuthor }}
      SourcesDirectory: $(Build.SourcesDirectory)
      BinariesDirectory: $(Build.BinariesDirectory)
      ArtifactDirectory: $(Build.ArtifactStagingDirectory)
  
  - template: ../stages/build-server-stage.yml
    parameters:
      MinecraftVersion: ${{ parameters.MinecraftVersion }}
      ModpackVersion: ${{ parameters.ModpackVersion }}
      ForgeVersion: ${{ parameters.ForgeVersion }}
      ModpackName: ${{ parameters.ModpackName }}
      ModpackAuthor: ${{ parameters.ModpackAuthor }}
      GitHubOrg: ${{ parameters.GitHubOrg }}
      GitHubRepo: ${{ parameters.GitHubRepo }}
      SourcesDirectory: $(Build.SourcesDirectory)
      BinariesDirectory: $(Build.BinariesDirectory)
      ArtifactDirectory: $(Build.ArtifactStagingDirectory)
      TempDirectory: $(Agent.TempDirectory)

  - template: ../stages/dev-stage.yml
    parameters:
      ModpackVersion: ${{ parameters.ModpackVersion }}
      ModpackName: ${{ parameters.ModpackName }}
      ServerID: $(DevServerID)
      PterodactylAddress: ${{ parameters.PterodactylAddress }}
      PipelineWorkspace: $(Pipeline.Workspace)
      GitHubOrg: ${{ parameters.GitHubOrg }}
      GitHubRepo: ${{ parameters.GitHubRepo }}
      SourcesDirectory: $(Build.SourcesDirectory)
      TempDirectory: $(Agent.TempDirectory)
      CreatePrerelease: ${{ parameters.CreatePrerelease }}

  - template: ../stages/staging-stage.yml
    parameters:
      ModpackVersion: ${{ parameters.ModpackVersion }}
      ModpackName: ${{ parameters.ModpackName }}
      ServerID: $(StagingServerID)
      PterodactylAddress: ${{ parameters.PterodactylAddress }}
      PipelineWorkspace: $(Pipeline.Workspace)
      GitHubOrg: ${{ parameters.GitHubOrg }}
      GitHubRepo: ${{ parameters.GitHubRepo }}
      SourcesDirectory: $(Build.SourcesDirectory)
      TempDirectory: $(Agent.TempDirectory)
      CreateRelease: ${{ parameters.CreateRelease }}

  - template: ../stages/prod-stage.yml
    parameters:
      ServerID: $(ProdServerID)
      PterodactylAddress: ${{ parameters.PterodactylAddress }}
      PipelineWorkspace: $(Pipeline.Workspace)
      isProdDeployment: ${{ parameters.isProdDeployment }}